<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>修复</title></head>
<body style="background:#111;color:#0f0;font-family:monospace;padding:20px">
<h2>钢子出击 - 修复登录状态</h2>
<pre id="log"></pre>
<script src="js/config.js"></script>
<script>
const L = document.getElementById('log');
function log(msg) { L.textContent += msg + '\n'; }

log('清除旧的登录状态...');
try {
    localStorage.removeItem('gangzi_token');
    localStorage.removeItem('gangzi_refresh_token');
    localStorage.removeItem('gangzi_user');
    log('✅ 已清除旧 token');
} catch(e) {
    log('❌ 清除失败: ' + e.message);
}

log('正在重新登录...');
fetch((window.API_BASE || window.location.origin) + '/api/auth/login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({username: 'a', password: '123'})
}).then(r => r.json()).then(data => {
    if (data.access_token) {
        localStorage.setItem('gangzi_token', data.access_token);
        localStorage.setItem('gangzi_refresh_token', data.refresh_token || '');
        localStorage.setItem('gangzi_user', data.username || 'a');
        log('✅ 新 token 已存储');
        log('3 秒后跳转到主页...');
        setTimeout(() => {
            window.location.href = '/index.html?v=' + Date.now();
        }, 3000);
    } else {
        log('❌ 登录失败: ' + JSON.stringify(data));
    }
}).catch(err => {
    log('❌ 网络错误: ' + err.message);
});
</script>
</body></html>
